<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RS Restaurant | Your Cart</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { background-color: #fffaf3; }

    /* Navbar */
    nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: #ffffff; box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1); position: sticky; top: 0; z-index: 1000; }
    .logo { font-size: 26px; font-weight: bold; color: rgb(30, 214, 162); text-transform: uppercase; }
    nav ul { display: flex; list-style: none; gap: 20px; }
    nav ul li a { text-decoration: none; color: #333; font-weight: 500; padding: 8px 12px; border-radius: 5px; transition: 0.3s; }
    nav ul li a:hover, nav ul li a.active { background: #179fde; color: #fff; }
    .menu-toggle { display: none; font-size: 28px; cursor: pointer; color: #179fde; }

    /* Cart Container */
    .cart-container { max-width: 1000px; margin: 50px auto; padding: 20px; background: #fff; border-radius: 15px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); min-height: 400px; }
    h2.title { text-align: center; color: #d35400; margin-bottom: 30px; font-size: 32px; }

    .empty-cart { text-align: center; display: none; padding: 50px 20px; }
    .back-btn { display: inline-block; background: rgb(30, 214, 162); color: white; padding: 10px 25px; text-decoration: none; border-radius: 25px; margin-top: 20px; }

    /* Table */
    .cart-table { width: 100%; border-collapse: collapse; }
    .cart-table th { text-align: left; padding: 15px; color: #fff; background: rgb(30, 214, 162); }
    .cart-table td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
    .cart-info { display: flex; align-items: center; gap: 15px; }
    .cart-info img { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; }
    .remove-link { color: #e74c3c; font-size: 12px; cursor: pointer; font-weight: 600; }

    /* Quantity Buttons */
    .qty-box { display: flex; align-items: center; gap: 10px; }
    .qty-btn { background: #f0f0f0; border: 1px solid #ccc; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; }

    /* Total Section */
    .total-price { display: flex; justify-content: flex-end; margin-top: 20px; }
    .total-table { border-top: 3px solid rgb(30, 214, 162); width: 100%; max-width: 350px; }
    .total-table td { padding: 10px; font-size: 16px; }
    .checkout-btn { display: block; width: 100%; background: #ff6347; color: white; padding: 12px; border-radius: 25px; margin-top: 15px; border: none; cursor: pointer; font-weight: 600; }

    @media (max-width: 768px) {
      .menu-toggle { display: block; }
      nav ul { position: fixed; top: 60px; left: -100%; width: 100%; height: 100vh; background: white; flex-direction: column; text-align: center; transition: 0.3s; }
      nav ul.show { left: 0; }
    }
  </style>
</head>

<body>

  <nav>
    <div class="logo">RS Restaurant</div>
    <div class="menu-toggle" onclick="document.getElementById('nav-links').classList.toggle('show')">‚ò∞</div>
    <ul id="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="menu.html">Menu</a></li>
      <li><a href="cart.html" class="active">Cart üõí</a></li>
      <li><a href="myorders.html">My Orders</a></li>
      <li><a href="loginpage.html">Login</a></li>
    </ul>
  </nav>

  <div class="cart-container">
    <h2 class="title">Your Food Cart</h2>
    <div id="empty-cart-msg" class="empty-cart">
      <h3>Your Cart is Empty! üçΩ</h3>
      <a href="menu.html" class="back-btn">Go to Menu</a>
    </div>

    <div id="cart-content">
      <table class="cart-table">
        <thead>
          <tr><th>Product</th><th>Quantity</th><th>Subtotal</th></tr>
        </thead>
        <tbody id="cart-body"></tbody>
      </table>

      <div class="total-price">
        <div class="total-table">
          <table>
            <tr><td>Subtotal</td><td id="subtotal-price">‚Çπ0</td></tr>
            <tr><td>Tax (5%)</td><td id="tax-price">‚Çπ0</td></tr>
            <tr><td style="font-weight:bold; color:#d35400;">Grand Total</td><td style="font-weight:bold; color:#d35400;" id="grand-total">‚Çπ0</td></tr>
          </table>
          <button class="checkout-btn" onclick="processCheckout()">Proceed to Checkout</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let cartItems = JSON.parse(localStorage.getItem('rsCart')) || [];
    const cartBody = document.getElementById('cart-body');
    const emptyMsg = document.getElementById('empty-cart-msg');
    const cartContent = document.getElementById('cart-content');

    function renderCart() {
      if (cartItems.length === 0) {
        cartContent.style.display = 'none';
        emptyMsg.style.display = 'block';
        return;
      }
      cartContent.style.display = 'block';
      emptyMsg.style.display = 'none';
      cartBody.innerHTML = "";
      
      let subtotal = 0;
      cartItems.forEach((item, index) => {
        let total = item.price * item.qty;
        subtotal += total;
        cartBody.innerHTML += `
          <tr>
            <td>
              <div class="cart-info">
                <img src="${item.image}" alt="${item.name}">
                <div>
                  <h4>${item.name}</h4>
                  <small>Price: ‚Çπ${item.price}</small><br>
                  <span class="remove-link" onclick="removeItem(${index})">Remove</span>
                </div>
              </div>
            </td>
            <td>
              <div class="qty-box">
                <button class="qty-btn" onclick="updateQty(${index}, -1)">-</button>
                <span>${item.qty}</span>
                <button class="qty-btn" onclick="updateQty(${index}, 1)">+</button>
              </div>
            </td>
            <td>‚Çπ${total}</td>
          </tr>`;
      });

      let tax = Math.round(subtotal * 0.05);
      document.getElementById('subtotal-price').innerText = "‚Çπ" + subtotal;
      document.getElementById('tax-price').innerText = "‚Çπ" + tax;
      document.getElementById('grand-total').innerText = "‚Çπ" + (subtotal + tax);
    }

    function updateQty(index, change) {
      if (cartItems[index].qty === 1 && change === -1) {
        removeItem(index); return;
      }
      cartItems[index].qty += change;
      localStorage.setItem('rsCart', JSON.stringify(cartItems));
      renderCart();
    }

    function removeItem(index) {
      cartItems.splice(index, 1);
      localStorage.setItem('rsCart', JSON.stringify(cartItems));
      renderCart();
    }

    function processCheckout() {
      // 1. Login Check
      const user = JSON.parse(localStorage.getItem("rsUser"));
      if (!user) {
        alert("Please Login first to place order!");
        window.location.href = "login.html";
        return;
      }

      // 2. Calculate Total Again
      let subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.qty), 0);
      let tax = Math.round(subtotal * 0.05);
      let grandTotal = subtotal + tax;

      // 3. Create Order Object
      const newOrder = {
        id: Date.now(),
        date: new Date().toLocaleString(),
        userEmail: user.email,
        items: cartItems, // IMPORTANT: Passing items array
        total: grandTotal,
        status: "Pending"
      };

      // 4. Save to History
      let history = JSON.parse(localStorage.getItem("rsOrderHistory")) || [];
      history.push(newOrder);
      localStorage.setItem("rsOrderHistory", JSON.stringify(history));

      // 5. Clear Cart & Redirect
      if(confirm("Place order for ‚Çπ" + grandTotal + "?")) {
        localStorage.removeItem('rsCart');
        window.location.href = "myorders.html";
      }
    }

    renderCart();
  </script>
</body>
</html>